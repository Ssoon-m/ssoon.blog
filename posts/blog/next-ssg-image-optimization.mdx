---
title: 'Next.js SSGì—ì„œ ì´ë¯¸ì§€ ìµœì í™” ë°©ë²•'
date: 2023-11-08
description: Next.jsì—ì„œ static export ì˜µì…˜ì„ í™œì„±í™” í–ˆì„ë•Œ cloudinaryë¥¼ í†µí•´ì„œ ì´ë¯¸ì§€ ìµœì í™”ë¥¼ í•˜ê³  ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ìë™í™” ì‹œí‚¤ê¸°
thumbnailUrl: /posts/blog/next-ssg-image-optimization/thumbnail.png
tags: 
  - Cloudinary
  - Image Optimization
  - Next
  - SSG
---

## ì‹œì‘í•˜ë©°
Next.jsì˜ `static export` ì˜µì…˜ì„ í™œì„±í™”í•˜ë©´, `<Image>` ì»´í¬ë„ŒíŠ¸ì˜ ì´ë¯¸ì§€ ìµœì í™” ê¸°ëŠ¥ì„ ì œëŒ€ë¡œ í™œìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ì´ëŠ” Next.jsê°€ ê¸°ë³¸ì ìœ¼ë¡œ [on-demand](https://nextjs.org/learn-pages-router/seo/improve/images) í˜•ì‹ìœ¼ë¡œ ì„œë²„ì—ì„œ ì´ë¯¸ì§€ ìµœì í™”ë¥¼ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ì´ ê¸€ì—ì„œëŠ” `static export`ì˜µì…˜ í™œì„±í™”ì‹œ ì´ë¯¸ì§€ ìµœì í™” ê¸°ëŠ¥ì„ ì–´ë–»ê²Œ ì ìš©í• ì§€ì— ëŒ€í•´ ë‹¤ë£¨ê³ ì í•©ë‹ˆë‹¤.


## static exportì‹œ ì´ë¯¸ì§€ ìµœì í™” ë°©ë²•


Next.js SSGì—ì„œ ì´ë¯¸ì§€ ìµœì í™”ëŠ” ê½¤ ì˜¤ë˜ì „ë¶€í„° ë§ì€ [ë…¼ì˜](https://github.com/vercel/next.js/discussions/19065)ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

ì•„ë˜ ë‘ê°€ì§€ ë°©ë²•ì— ëŒ€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.
1. ë¹Œë“œ íƒ€ì„ì‹œ ì´ë¯¸ì§€ ìµœì í™”
2. ì´ë¯¸ì§€ ê´€ë¦¬ ë° ìµœì í™” ì„œë¹„ìŠ¤ë¥¼ í•´ì£¼ëŠ” í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©

1ë²ˆì˜ ê²½ìš°ì—” ì•„ì§ê¹Œì§€ëŠ” Next.jsì—ì„œ ê³µì‹ì ìœ¼ë¡œ ì œê³µí•  ìƒê°ì´ ì—†ì–´ ë³´ì˜€ìŠµë‹ˆë‹¤.
(ë¹Œë“œ íƒ€ì„ì‹œ ì´ë¯¸ì§€ ìµœì í™”ëŠ” [next-image-export-optimizer](https://github.com/Niels-IO/next-image-export-optimizer)ì™€ ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ê±°ë‚˜ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.)

2ë²ˆì€ Next.jsì˜ [ê³µì‹ë¬¸ì„œ](https://nextjs.org/docs/app/building-your-application/deploying/static-exports#image-optimization)ì—ì„œ ì´ë¯¸ì§€ ìµœì í™”ì— `Cloudinary`ë¥¼ ê¶Œì¥í•˜ê³  ìˆê¸° ë•Œë¬¸ì— 2ë²ˆ ë°©ë²•ìœ¼ë¡œ ìµœì í™”ë¥¼ í•˜ê³ ì í•©ë‹ˆë‹¤.
(ë¬¼ë¡  2ë²ˆ ë°©ë²•ì„ `Cloudinary`ë¡œë§Œ êµ¬í˜„ì´ ê°€ëŠ¥í•œê±´ ì•„ë‹™ë‹ˆë‹¤. [CloudFront ë° AWS Lambda](https://aws.amazon.com/ko/blogs/networking-and-content-delivery/image-optimization-using-amazon-cloudfront-and-aws-lambda/)ë¥¼ ì´ìš©í•œ ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.)


## Cloudinaryë€?
[Cloudinary](https://cloudinary.com/)ëŠ” ì´ë¯¸ì§€ ë° ë¹„ë””ì˜¤ ê´€ë¦¬ ë° ìµœì í™” ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” í´ë¼ìš°ë“œ ê¸°ë°˜ í”Œë«í¼ì…ë‹ˆë‹¤.  
ì´ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ì‚¬ìš©ìëŠ” ì›¹ í˜ì´ì§€ì˜ ì´ë¯¸ì§€ ë° ë¹„ë””ì˜¤ ê´€ë¦¬ë¥¼ ê°„í¸í•˜ê²Œ í•  ìˆ˜ ìˆìœ¼ë©°, ì„±ëŠ¥ ìµœì í™”ì™€ ë¹ ë¥¸ ë¡œë”©ì„ ì‹¤í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
CloudinaryëŠ” ì´ë¯¸ì§€ ë³€í™˜, í¬ë¡­, ë¦¬ì‚¬ì´ì¦ˆ, íš¨ê³¼ ë° ë‹¤ìš´ë¡œë“œ ë° ì „ì†¡ ê´€ë¦¬ ë“± ë‹¤ì–‘í•œ ì´ë¯¸ì§€ ê´€ë¦¬ ì‘ì—…ì„ ì§€ì›í•©ë‹ˆë‹¤.

> ê·¸ë¦¬ê³  ì œì¼ ì¤‘ìš”í•œ(?) **ìš”ê¸ˆì œ ì •ì±…**ì„ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.
![cloudinary-plan](/posts/blog/next-ssg-image-optimization/cloudinary-plan.png)
ë¬´ë£Œí”Œëœ ê¸°ì¤€ìœ¼ë¡œ í•œ ë‹¬ì— 25 í¬ë ˆë”§ì„ ì œê³µí•´ì¤€ë‹¤ê³  í•©ë‹ˆë‹¤. (1í¬ë ˆë”§ = 1000ë²ˆì˜ íŒŒì¼ë³€í™˜, 1GBì˜ ì €ì¥ìš©ëŸ‰, 1GBì˜ ëŒ€ì—­í­)
ê°œì¸ ë¸”ë¡œê·¸ì™€ ê°™ì€ SSGì‚¬ì´íŠ¸ë¥¼ ìš´ì˜í• ë•ŒëŠ” ë¬´ë£Œí”Œëœìœ¼ë¡œ í•´ë„ ë¬¸ì œê°€ ì—†ì–´ ë³´ì…ë‹ˆë‹¤.


## Cloudinary ì‚¬ìš©ë²•

ìš°ì„  Cloudinary ì— ë¡œê·¸ì¸ì„ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
ê·¸ í›„ Cloudinaryì— ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³  ì‚¬ì§„ì˜ urlì„ í”„ë¡œì íŠ¸ì—ì„œ ì´ìš©í•˜ë©´ ëì…ë‹ˆë‹¤.

ì—…ë¡œë“œë¥¼ í•˜ëŠ” ë°©ë²•ì€ ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤.
1. `Digital Asset Management` íƒ­ìœ¼ë¡œ ì´ë™
2. ìš°ì¸¡ ìƒë‹¨ì˜ Uploadë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì›í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ
![upload-example](/posts/blog/next-ssg-image-optimization/upload-example.png)

ìœ„ ê³¼ì •ì„ ë§ˆì³¤ë‹¤ë©´, Next.js í”„ë¡œì íŠ¸ì˜ configì— loader ì„¤ì •ì„ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
(`static export` ì˜µì…˜ì´ ìˆë‹¤ë©´, `unoptimized`ë‚˜ `loader` ë‘˜ ì¤‘ì— í•˜ë‚˜ë¥¼ ë¬´ì¡°ê±´ ì„¤ì •í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.)

``` javascript
// next.config.js

/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  images: {
    loader: 'custom',
    loaderFile: './my-loader.ts',
  },
}
 
module.exports = nextConfig

```

ì´ ë¡œë”ëŠ” ì›ê²© ì†ŒìŠ¤ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²•ì„ ì •ì˜í•©ë‹ˆë‹¤. Cloudinaryì— ëŒ€í•œ URLì„ êµ¬ì„±í•´ì¤ë‹ˆë‹¤.
``` typescript
export default function cloudinaryLoader({
  src,
  width,
  quality,
}: {
  src: string
  width: number
  quality?: number
}) {
  const params = ['f_auto', 'c_limit', `w_${width}`, `q_${quality || 'auto'}`]
  return `https://res.cloudinary.com/demo/image/upload/${params.join(
    ','
  )}${src}`
}
```

loader ì„¤ì •ê¹Œì§€ ì™„ë£Œê°€ ëë‹¤ë©´, Next.js Image ì»´í¬ë„ŒíŠ¸ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ì„ í–ˆì„ ë•Œ
``` tsx
<Image src='/demo' width={50} height={50}/>
```
image srcê°€ `cloudinaryLoader` ì˜ return ê°’ìœ¼ë¡œ ë°”ë€Œê²Œ ë©ë‹ˆë‹¤.

loaderë•ë¶„ì— ê¸°ì¡´ SSGí”„ë¡œì íŠ¸ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ê±´ë“œë¦¬ì§€ ì•Šê³  ì„¤ì •ë§Œ ë°”ê¿”ì„œ ì ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

## Cloudinary ì—…ë¡œë“œ ìë™í™” í•˜ê¸°


SSG í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ë©´ì„œ í•„ìš”í•œ ì´ë¯¸ì§€ë“¤ì„ ì¼ì¼ì´ Cloudinaryì— ì—…ë¡œë“œ ì‹œí‚¤ëŠ”ê±´ ìƒìƒë§Œí•´ë„ ìƒì‚°ì„±ì´ ë§ì´ ë–¨ì–´ì§€ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.
ë”°ë¼ì„œ [Cloudinary Node.js SDK](https://cloudinary.com/documentation/node_quickstart)ë¥¼ ì´ìš©í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ìë™í™”ë¥¼ í•˜ê³ ì í•©ë‹ˆë‹¤.

>ì´ë£¨ê³ ì í•˜ëŠ” ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
1. `public` í´ë” ì•„ë˜ì˜ ì´ë¯¸ì§€ë“¤ì„ ì „ë¶€ Cloudinaryì— ì—…ë¡œë“œ
2. ê¸°ì¡´ì— Next.jsì—ì„œ ì •ì  assets ë“¤ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ì— ì˜í–¥ì„ ì£¼ì–´ì„  ì•ˆëœë‹¤. (ì˜ˆë¥¼ë“¤ë©´, `public/my-profile.png` íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ë•Œ `/my-profile.png` ë¡œ íŒŒì¼ ì°¸ì¡°)
3. scriptë¥¼ í•œ ë²ˆ ì‹¤í–‰ì‹œì¼œì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œê°€ ë™ì‘

### cloudinary ì„¤ì • í™•ì¸
Cloudinaryë¡œê·¸ì¸ì‹œ ë³´ì´ëŠ” í™”ë©´ì…ë‹ˆë‹¤.
Node.jsì—ì„œ ì–´ë–¤ì‹ìœ¼ë¡œ ì„¤ì •ì„ í•´ì•¼í•˜ëŠ”ì§€ ì˜ˆì‹œê°€ ë‚˜ì˜µë‹ˆë‹¤.
![cloudinary-env](/posts/blog/next-ssg-image-optimization/cloudinary-env.png)

ë§Œì•½ cloud_nameì„ ë°”ê¾¸ê³  ì‹¶ë‹¤ë©´ `setting -> account` ì— ë“¤ì–´ê°„ í›„ editì„ ëˆŒëŸ¬ì„œ ìˆ˜ì •ì„ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.
![change-cloud-name](/posts/blog/next-ssg-image-optimization/change-cloud-name.png)


### script í™˜ê²½ ì„¸íŒ…

cloudinaryì™€ globì„ ì´ìš©í•´ì¤ë‹ˆë‹¤.

> glob ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ íŒ¨í„´ ë§¤ì¹­ì„ í†µí•´ íŒŒì¼ ë° ë””ë ‰í† ë¦¬ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` shell
$ yarn add -D cloudinary
$ yarn add -D glob
```

ì €ëŠ” `api_key`ì™€ `api_secret`ì˜ ê°’ì„ `env`ë¡œ ê´€ë¦¬í•  ì˜ˆì •ì´ë¯€ë¡œ `dotenv`ë„ ì¶”ê°€ë¡œ ë°›ì•„ì¤¬ìŠµë‹ˆë‹¤.

scriptsí´ë” ì•„ë˜ì— `upload-cloudinary.ts` íŒŒì¼ì„ ìƒì„±í•´ì„œ cloudinary ì„¤ì • ê´€ë ¨ ì½”ë“œë¥¼ ì‘ì„±í•´ì¤¬ìŠµë‹ˆë‹¤.

``` typescript
// scripts/upload-cloudinary.ts
import { v2 as cloudinary } from 'cloudinary';
import { glob } from 'glob';
import dotenv from 'dotenv';

dotenv.config();

cloudinary.config({
  cloud_name: 'ssoon',
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET,
  secure: true, // Return "https" URLs by setting secure: true
});

// Log the configuration
console.log(cloudinary.config());

```
`upload-cloudinary.ts` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ `package.json`ì˜ scriptsì— ì‘ì„±ì„ í•´ì¤ë‹ˆë‹¤.
(tsíŒŒì¼ë¡œ ì‘ì„±ì„ í•´ì„œ `ts-node` ë¡œ ì‹¤í–‰ì„ ì‹œì¼°ìŠµë‹ˆë‹¤. jsíŒŒì¼ë¡œ ì‘ì„±í•˜ê³  `node ./scripts/upload-cloudinary.js`ë¡œ ì‹¤í–‰ì‹œì¼œë„ ë¬´ê´€í•©ë‹ˆë‹¤. )
``` javascript

 "scripts": {
    "upload-cloudinary": "ts-node --project tsconfig.node.json ./scripts/upload-cloudinary.ts"
  },
```

`upload-cloudinary` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ ì‹œí‚¨í›„ì— ìœ„ì—ì„œ ì„¤ì •í•œ configê°€ ì œëŒ€ë¡œ ë¡œê·¸ì— ë‹¤ìŒê³¼ ê°™ì´ ì°íˆëŠ”ì§€ í™•ì¸ì„ í•´ì¤ë‹ˆë‹¤.
``` javascript
{
  cloud_name: 'ssoon',
  api_key: '*********',
  api_secret: '*********',
  secure: true
}
```

ì„¤ì •ì„ ì™„ë£Œ í–ˆìœ¼ë¯€ë¡œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê´€ë ¨ ë¡œì§ì„ ì‘ì„±í•´ì¤ë‹ˆë‹¤.
[ì—…ë¡œë“œ ê´€ë ¨ ë¬¸ì„œ](https://cloudinary.com/documentation/node_quickstart#2_upload_an_image)ë¥¼ í™•ì¸í•´ ë³´ë©´ `cloudinary.uploader.upload` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

uploadì— í•„ìš”í•œ ê° ì˜µì…˜ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.
- `use_filename` : ì—…ë¡œë“œëœ íŒŒì¼ì˜ ì›ë˜ ì´ë¦„ì„ ê³µê°œ IDë¡œ ì‚¬ìš©í•˜ë„ë¡ í•´ì¤ë‹ˆë‹¤. ë§Œì•½ `true` ë¡œ ì„¤ì •í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, `8jsb1xofxdqamu2rzwt9q` ì™€ ê°™ì€ ë¬´ì‘ìœ„ IDê°€ ìƒì„±ì´ ë˜ë¯€ë¡œ ë¬´ì¡°ê±´ `true`ë¡œ ì„¤ì •ì„ í•´ì•¼ í•©ë‹ˆë‹¤.
- `unique_filename` : ì˜µì…˜ì€ ê³µê°œ IDì— ì„ì˜ì˜ ë¬¸ìë¥¼ ì ìš©í•´ì¤ë‹ˆë‹¤. `false`ë¡œ ì„¤ì •í•´ì•¼ ì„ì˜ì˜ ë¬¸ìë¥¼ ì ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- `overwrite` : ì—…ë¡œë“œ ì‹œ ë™ì¼í•œ ê³µê°œ IDë¥¼ ê°€ì§„ ì´ë¯¸ì§€ë¥¼ ë®ì–´ì”ë‹ˆë‹¤.

uploadë¬¸ì„œ ì˜ˆì‹œì—ëŠ” ì—†ì§€ë§Œ ì €ëŠ” ì¶”ê°€ì ìœ¼ë¡œ `folder` ì˜µì…˜ë„ ì¶”ê°€ë¥¼ í•´ì¤¬ìŠµë‹ˆë‹¤.


> `folder` ì˜µì…˜ì´ ì—†ë‹¤ë©´, ë‚´ê°€ ì›í•˜ëŠ” ëìŠ¤ì— ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ì§€ ëª»í•©ë‹ˆë‹¤.
Next.jsí”„ë¡œì íŠ¸ì—ì„œ `public/logo/site-og-image.png` ì˜ ì´ë¯¸ì§€ íŒŒì¼ì„ `folder` ì˜µì…˜ ì—†ì´ Cloudinaryì— ì—…ë¡œë“œë¥¼ í•œë‹¤ë©´ ë¬´ì¡°ê±´ rootê²½ë¡œì— ì—…ë¡œë“œê°€ ë©ë‹ˆë‹¤. (`https://res.cloudinary.com/{cloud_name}/image/upload/site-og-image.png` ê²½ë¡œì— ì—…ë¡œë“œê°€ ë©ë‹ˆë‹¤.)
Cloudinaryë¥¼ ì ìš©í•˜ê¸°ì „ í”„ë¡œì íŠ¸ì—ì„  `<Image src='logo/site-og-image.png'/>` ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í˜¸ì¶œì„ í•˜ê³  ìˆì—ˆì„í…ë° ë§Œì•½ `~~~/upload/site-og-image.png` ê²½ë¡œì— ì—…ë¡œë“œê°€ ëë‹¤ë©´ ê¸°ì¡´ ì†ŒìŠ¤ì½”ë“œë¥¼ `<Image src='/site-og-image.png'/>` ë¡œ ë°”ê¿”ì¤˜ì•¼ í•©ë‹ˆë‹¤. (cloudinaryLoaderë¥¼ ì„¤ì • í–ˆìœ¼ë¯€ë¡œ `~~~/upload/` ë¶€ë¶„ì€ ì ì–´ì¤„ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.) `folder` ì˜µì…˜ì— "logo" ë¥¼ ì ì–´ì£¼ê²Œ ëœë‹¤ë©´ `~~~/upload/logo/site-og-image.png` ê²½ë¡œì— ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œê°€ ë©ë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ ì˜µì…˜ì„ êµ¬ì„±í•´ì„œ uploadImage í•¨ìˆ˜ë¥¼ ì‘ì„±í•´ ì¤ë‹ˆë‹¤.
``` typescript
// scripts/upload-cloudinary.ts
const uploadImage = async ({
  imagePath,
  folder,
}: {
  imagePath: string;
  folder: string;
}) => {
  const options = {
    use_filename: true, // Use the uploaded file's name as the asset's public ID and
    unique_filename: false,
    overwrite: true, // allow overwriting the asset with new versions
    folder,
  };

  // Upload the image
  const result = await cloudinary.uploader.upload(imagePath, options);
  return result.public_id;
};
```

globìœ¼ë¡œ public í´ë” ì•„ë˜ì˜ `.jpg, .jpeg, .png, .gif ` ë“±ì˜ í™•ì¥ìê°€ ìˆëŠ” ê²½ë¡œë¥¼ íŒ¨í„´ë§¤ì¹­ìœ¼ë¡œ ê²€ìƒ‰í•˜ê³  ì¼ì¹˜í•˜ëŠ” íŒŒì¼ ê²½ë¡œë¥¼ ë°˜í™˜ ë°›ìŠµë‹ˆë‹¤.



>![folder-tree](/posts/blog/next-ssg-image-optimization/folder-tree.png)
ì˜ˆë¥¼ ë“¤ì–´ í´ë”êµ¬ì¡°ê°€ ìœ„ì™€ ê°™ì´ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©´
`['public/posts/blog/example/example-1.png','public/posts/blog/example/example-2.png','public/static/my-profile.webp']`
ìœ„ ëª©ë¡ì„ ë°˜í™˜ë°›ì„ ìˆ˜ ìˆê²Œ íŒ¨í„´ì„ ì‘ì„±í•´ì¤ë‹ˆë‹¤.

        

globì„ ì´ìš©í•´ì„œ ë°˜í™˜ë°›ì€ íŒŒì¼ ê²½ë¡œëŠ” `uploadImage` í•¨ìˆ˜ì˜ `imagepath` íŒŒë¼ë¯¸í„°ì— ê·¸ëŒ€ë¡œ ë„£ì–´ì¤ë‹ˆë‹¤.
ê·¸ë¦¬ê³  `imagepath` ì˜ ê²½ë¡œë¥¼ publicì„ ì œì™¸í•˜ê³  ë„£ì–´ì¤„ ìˆ˜ ìˆê²Œ ë¡œì§ì„ ì‘ì„±í•´ì¤ë‹ˆë‹¤.
(publicì„ ì œì™¸í•˜ëŠ” ì´ìœ ëŠ” ìœ„ì—ì„œ ê³„ì† ì„¤ëª…ì„ í–ˆë“¯ì´ Next.js í”„ë¡œì íŠ¸ ë‚´ë¶€ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í• ë•Œ publicì„ ë¶™ì´ê³  ê°€ì ¸ì˜¤ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.)

``` typescript
// scripts/upload-cloudinary.ts
(async () => {
  const blogImgPaths = await glob(['public/**/*.{jpg,jpeg,png,gif,webp,svg}']);

  if (blogImgPaths.length) {
    const uploadPromises = blogImgPaths.map(async (imgPath) => {
      const folder = imgPath
        .replace('public/', '')
        .replace(/\/[^/]+\.(jpg|jpeg|png|gif|webp|svg)$/, '');
      return uploadImage({
        imagePath: imgPath,
        folder,
      });
    });
    try {
      const result = await Promise.all(uploadPromises);
      console.log('result', result);
    } catch (e: any) {
      throw new Error(e);
    }
  }
})();
```
ìµœì¢… ì½”ë“œì˜ ëª¨ìŠµì…ë‹ˆë‹¤.
```typescript
// scripts/upload-cloudinary.ts
import { v2 as cloudinary } from 'cloudinary';
import { glob } from 'glob';
import dotenv from 'dotenv';

dotenv.config();

cloudinary.config({
  cloud_name: 'ssoon',
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET,
  secure: true, // Return "https" URLs by setting secure: true
});

// Log the configuration
console.log(cloudinary.config());
/////////////////////////
// Uploads an image file
/////////////////////////
const uploadImage = async ({
  imagePath,
  folder,
}: {
  imagePath: string;
  folder: string;
}) => {
  const options = {
    use_filename: true, // Use the uploaded file's name as the asset's public ID and
    unique_filename: false,
    overwrite: true, // allow overwriting the asset with new versions
    folder,
  };

  // Upload the image
  const result = await cloudinary.uploader.upload(imagePath, options);
  return result.public_id;
};

(async () => {
  const blogImgPaths = await glob(['public/**/*.{jpg,jpeg,png,gif,webp,svg}']);
  if (blogImgPaths.length) {
    const uploadPromises = blogImgPaths.map(async (imgPath) => {
      const folder = imgPath
        .replace('public/', '')
        .replace(/\/[^/]+\.(jpg|jpeg|png|gif|webp|svg)$/, '');
      return uploadImage({
        imagePath: imgPath,
        folder,
      });
    });
    try {
      const result = await Promise.all(uploadPromises);
      console.log('result', result);
    } catch (e: any) {
      throw new Error(e);
    }
  }
})();

```
ì´ì œ publicí´ë”ì— ì´ë¯¸ì§€ë¥¼ ë§‰ ë„£ê³  `yarn upoad-cloudinary` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ ì‹œí‚¨ ê²°ê³¼ì…ë‹ˆë‹¤.

![upload-scripts-result](/posts/blog/next-ssg-image-optimization/upload-scripts-result.png)

cloudinaryì— ìë™ìœ¼ë¡œ ì—…ë¡œë“œê°€ ë˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
(ì•„ë˜ ì‚¬ì§„ì€ `posts/blog` ì•„ë˜ì— ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë“¤ë§Œ ë³¸ ê²°ê³¼ì…ë‹ˆë‹¤. )
![cloudinary-image-upload-result](/posts/blog/next-ssg-image-optimization/cloudinary-image-upload-result.png)

ì´ì œ í”„ë¡œì íŠ¸ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ë•Œ `static assets`ê²½ë¡œë¥¼ ì ì–´ì£¼ë©´ ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ cloudinaryLoader í†µí•´ Cloudinaryì— ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` tsx
<Image
  src="/logo/white-logo.png"
  width={80}
  height={40}
  priority
  alt="site logo"
/>
```



## ë§ˆì¹˜ë©°
Next.jsì—ì„œ ìì²´ì ìœ¼ë¡œ ë¹Œë“œíƒ€ì„ë•Œ ì´ë¯¸ì§€ ìµœì í™”ë¥¼ í•´ì¤€ë‹¤ë©´ ì´ëŸ° ë²ˆê±°ë¡œìš´ ì‘ì—…ì€ ì•ˆ í•´ë„ ë  ê±° ê°™ì€ë° ì‚´ì§ ì•„ì‰¬ìš´ê±° ê°™ìŠµë‹ˆë‹¤.
Next.jsë¥¼ SSGë¡œ ë§ˆì¼€íŒ…í•˜ëŠ” ê²ƒì€ ì˜¬ë°”ë¥´ì§€ ì•Šë‹¤ëŠ” [ì˜ê²¬](https://github.com/vercel/next.js/issues/36431#issue-1214119137)ë„ ë³´ì´ë„¤ìš” ğŸ˜…
(ê·¸ë˜ë„ Next.js SSGë¡œ [ê°œì¸ ë¸”ë¡œê·¸](https://ianlog.me/)ë¥¼ ë§Œë“¤ë•Œ ì´ë¯¸ì§€ ìµœì í™” ì‘ì—…ì„ ì œì™¸í•˜ë©´ ì¢‹ì€ ê²½í—˜ì´ì˜€ìŠµë‹ˆë‹¤..)

